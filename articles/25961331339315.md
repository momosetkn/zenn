---
title: "Doma CodeGen Pluginã§Java16ã®record class/Kotlinã®data classã®Entityã‚’ç”Ÿæˆã™ã‚‹"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Java", "Kotlin", "Doma", "DomaCodeGen"]
published: true
---

# å‰æ

org.domaframework.doma.codegen:2.0.0
Java16ä»¥ä¸Š

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚«ã‚¹ã‚¿ãƒ æ–¹æ³•

æ™‚ä»£ã¯ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«â€¦ã¨ã„ã†ã“ã¨ã§ã€Java16ã®record classã¨Kotlinã®data classã‚’ä½¿ã£ã¦Entityã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒ ã§ãã‚‹ã‚‰ã—ãã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ä»¥ä¸‹èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚

https://doma.readthedocs.io/ja/latest/codegen/#using-custom-template-files
> ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´ã›ãšã«ã‚³ãƒ”ãƒ¼ã—ã¦å†…å®¹ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ æ¬¡ã«ã€ templateDir ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¾ã™ã€‚

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒ 

build.gradle.ktsã®domaCodeGen -> register -> templateDirã«ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```kotlin
templateDir = file("src/main/resources/doma_codegen_template")
```

è¨­å®šä¾‹
https://github.com/momosetkn/experimental-doma/blob/de0ee05fef47ef5618d74b612f0894712242bb5d/build.gradle.kts#L242

## Java16ã®record classã®Entityã‚’ç”Ÿæˆã™ã‚‹

ä»¥ä¸‹ã®å…ƒã¨ã™ã‚‹entity.ftlã‚’ãƒ™ãƒ¼ã‚¹ã«ã„ã˜ã£ã¦ã„ãã¾ã™ã€‚
https://github.com/domaframework/doma-codegen-plugin/blob/master/codegen/src/main/resources/org/seasar/doma/gradle/codegen/template/java/entity.ftl

ã§ã€å®Œæˆã—ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒä»¥ä¸‹ã§ã™ã€‚recordã‚¯ãƒ©ã‚¹ã¯ç¶™æ‰¿ãŒã§ããªã„ãŸã‚ã€useMappedSuperclassã®è¨­å®šã‚’ç„¡è¦–ã—ã¦ã„ã¾ã™ã€‚
https://github.com/momosetkn/experimental-doma/blob/3482436c479ea6e6dccc6bb077a3ef809ac2779e/src/main/resources/doma_codegen_template/java/entity.ftl

## Kotlinã®data classã®Entityã‚’ç”Ÿæˆã™ã‚‹

ä»¥ä¸‹ã®å…ƒã¨ã™ã‚‹entity.ftlã‚’ãƒ™ãƒ¼ã‚¹ã«ã„ã˜ã£ã¦ã„ãã¾ã™ã€‚
https://github.com/domaframework/doma-codegen-plugin/blob/master/codegen/src/main/resources/org/seasar/doma/gradle/codegen/template/kotlin/entity.ftl

https://github.com/domaframework/doma-codegen-plugin/blob/fc026b9b1fba43952f6b498d5eb3962909428fad/codegen/src/main/java/org/seasar/doma/gradle/codegen/desc/KotlinClassResolver.java
https://github.com/domaframework/doma-codegen-plugin/blob/d2b67e04f9b42f4db265105e660211e36970a407/codegen/src/main/java/org/seasar/doma/gradle/codegen/desc/EntityPropertyDescFactory.java#L139
ã“ã¡ã‚‰ã‚’è¦‹ã‚‹ã¨ã€Stringã‚„LocalDateTimeãŒã™ã¹ã¦nullableæ‰±ã„ã«ãªã£ã¦ã—ã¾ã†ã‚ˆã†ã§ã€KotlinClassResolverã§æœªå®šç¾©ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’"null"ã¨ã—ã¦ã„ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒ"null"ã‚‚nullableã¨åˆ¤å®šã™ã‚‹æŒ™å‹•ã¨çµ„ã¿åˆã‚ã•ã£ã¦ã€ã“ã®æŒ™å‹•ã«ãªã‚‹ã‚ˆã†ã§ã™ã€‚

ãã“ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒ"null"ã˜ã‚ƒãªã„LanguageClassResolverã‚’build.gradle.ktsä¸Šã§å®šç¾©ã—ã€ãã‚Œã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ã—ã¦å›é¿ã—ã¾ã—ãŸã€‚
https://github.com/momosetkn/experimental-doma/blob/794422339cea5e5e028f9cdf1d4cb7206bf15c07/build.gradle.kts#L235-L240

ã§ã€å®Œæˆã—ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒä»¥ä¸‹ã§ã™ã€‚data classã¯Java16ã®recordã‚¯ãƒ©ã‚¹ã¨é•ã£ã¦ç¶™æ‰¿ã¯ã§ãã¾ã™ãŒã€ã¼ãã®å ´åˆã¯ç¶™æ‰¿ã‚’ä½¿ã‚ãªã„ã®ã§ã€useMappedSuperclassã®è¨­å®šã‚’ç„¡è¦–ã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸå…ƒã®entity.ftlã ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€nullableã®å ´åˆã®ã¿nullã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
https://github.com/momosetkn/experimental-doma/blob/5f0a8db9b3a25dffac25baa9412412fbd4502f08/src/main/resources/doma_codegen_template/kotlin/entity.ftl


# ãã®ä»–è¨­å®š

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ã€EntityListener(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§è¨€ã†ãƒˆãƒªã‚¬ãƒ¼ã¿ãŸã„ãªæ©Ÿèƒ½)ã‚„æŠ½è±¡ã‚¯ãƒ©ã‚¹ãŒä½¿ã‚ã‚Œã‚‹ã‚‰ã—ã„ã§ã™ãŒã€ä¸è¦ã§ã‚ã‚Œã°ã€ä»¥ä¸‹è¨­å®šã‚’build.gradle.ktsã®domaCodeGen -> register -> entityãƒ–ãƒ­ãƒƒã‚¯ã«ä»˜ä¸ã—ã¾ã™ã€‚

```kotlin
useListener = false
useMappedSuperclass = false
```

è¨­å®šä¾‹
https://github.com/momosetkn/experimental-doma/blob/794422339cea5e5e028f9cdf1d4cb7206bf15c07/build.gradle.kts#L254-L255
